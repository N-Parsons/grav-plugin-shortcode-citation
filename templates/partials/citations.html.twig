{# 'citations' is an ordered list of references provided by the plugin  #}

{% if config.plugins["shortcode-citation"]["builtin_css"] %}
  {% do assets.addCss("plugins://shortcode-citation/css/citations.css") %}
{% endif %}

{% set cites = citations.getCitations() %}

{% set reference_list = page.header.references %}
{% set references = {} %}

{% for ref in reference_list %}
  {# Adding "ref-" avoids issues with numeric IDs acting as indices #}
  {% set references = references|merge({("ref-"~ref["id"]): ref}) %}
{% endfor %}


{# 'heading' comes via Shortcode #}
{% if not heading is same as("false") %}
  {% set heading_text = heading ?: config['plugins.shortcode-citation.heading_text'] ?: "References" %}
{% endif %}


{% if cites %}
  <section class="references">
    {% if heading_text %}
      <h2>{{ heading_text }}</h2>
    {% endif %}

    <ol>
      {% for citeId in cites %}
        {% set reference = references["ref-"~citeId] %}

        {% spaceless %}
          {% if reference %}
            <li id="cite-{{ citeId }}">
              {% include 'partials/citations/'~reference.type~'.html.twig' with { 'ref': reference } %}
            </li>
          {% else %}
            <li id="cite-{{ citeId }}">
              <span class="cite-error">ERROR:</span> Missing or incorrect citation ID ("{{ citeId }}")
            </li>
          {% endif %}
        {% endspaceless %}
      {% endfor %}
    </ol>

  </section>
{% endif %}
